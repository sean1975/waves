<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<link type="text/css" rel="stylesheet"  href="/stylesheets/styles.css" />
<title>Cairns Waves</title>
<script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
<script type="text/javascript">
    google.charts.load('current', {'packages':['corechart']});
    google.charts.setOnLoadCallback(drawChart);
    function drawChart() {
        var data = google.visualization.arrayToDataTable([
            ['Date Time', 'Avg', 'Max'],
{% for record in records %}
    {% if record.Hmax|float > 0 %}
            [new Date({{ record.Seconds }} * 1000), {{ record.Hsig|float|round(2) }}, {{ record.Hmax|float|round(2) }}]{% if not loop.last %},{% endif %}
    {% endif %}
{% endfor %}
        ]);
        
        var last_historical_row = data.getNumberOfRows()-1;
        var last_historical_datetime = data.getValue(last_historical_row, 0);
        var last_historical_max_height = data.getValue(last_historical_row, 2);
        
        data.addColumn('number', 'Forecast 1');
        row_index = data.addRow();
        data.setValue(row_index, 0, last_historical_datetime);
        data.setValue(row_index, 3, last_historical_max_height);

{% for record in forecast2 %}
        row_index = data.addRow();
        data.setValue(row_index, 0, new Date({{ record.Seconds }} * 1000));
        data.setValue(row_index, 3, {{ record.Seas|float|round(2) }});
{% endfor %}

        data.addColumn('number', 'Forecast 2');
        var row_index = data.addRow();
        data.setValue(row_index, 0, last_historical_datetime);
        data.setValue(row_index, 4, last_historical_max_height);

{% for record in forecast %}
        row_index = data.addRow();
        data.setValue(row_index, 0, new Date({{ record.Seconds }} * 1000));
        data.setValue(row_index, 4, {{ record.Waves|float|round(2) }});
{% endfor %}        


        var formatter_options = new Object();
        formatter_options['pattern'] = 'hh:mm a';
        var formatter = new google.visualization.DateFormat(formatter_options);
        formatter.format(data, 0)
        
        var number_formatter = new google.visualization.NumberFormat({suffix: 'm'});
        number_formatter.format(data, 1);
        number_formatter.format(data, 2);
        number_formatter.format(data, 3);
        number_formatter.format(data, 4);
        
        var options = {
            title: 'Cairns Waves',
            hAxis: {
                format: ["EEE\nd'th'"],
                gridlines: { count: 15 },
                titleTextStyle: {color: '#333'}
            },
            vAxis: {title: 'Wave Height (m)', minValue: 0},
            series: {
            	0: {
            		color: 'blue',
            		areaOpacity: 0.6
            	},
            	1: {
            		color: 'red',
            		areaOpacity: 0.2
            	},
                2: {
                	lineDashStyle: [8, 4],
                	color: 'red',
                	areaOpacity: 0.1
                },
            	3: {
            		lineDashStyle: [2, 4],
            		color: 'red',
            		areaOpacity: 0.1
            	}
            }
        };

        var chart = new google.visualization.AreaChart(document.getElementById('chart_div'));
        chart.draw(data, options);
    }
</script>
</head>
<body>

<div id="chart_div"></div>

<div id="references">
    <span>Forecast 1 from <a href='http://www.bom.gov.au/qld/forecasts/cairns-coast.shtml'>Bureau of Meteorology</a></span><br>
    <span>Forecast 2 from <a href='http://www.seabreeze.com.au/graphs/qld2.asp'>www.seabreeze.com.au</a></span><br>
</div>

{% if debug|length > 0 %}

<div class="statistics">
<table>
    <tr>
        <th>Date Time</th>
        <th>Avg Height</th>
        <th>Max Height</th>
        <th>Direction</th>
        <th>Temperature</th>
    </tr>
{% for record in forecast|reverse %}
    <tr class="{{ loop.cycle('odd', 'even') }}">
        <td>{{ record.DateTime }}</td>
        <td> </td>
        <td>{{ record.Waves|float|round(2) }}</td>
        <td>{{ record.Direction }}</td>
        <td> </td>
    </tr>
{% endfor %}

{% for record in records|reverse %}
    <tr class="{{ loop.cycle('odd', 'even') }}">
        <td>{{ record.DateTime|replace('T', ' ') }}</td>
        <td>{{ record.Hsig|float|round(2) }} </td>
        <td>{{ record.Hmax|float|round(2) }}</td>
        <td>{{ record.Direction|float|round(2) }}</td>
        <td>{{ record.SST }}</td>
    </tr>
{% endfor %}
</table>
</div>

    {% for log in debug %}
    <br>
    <span>{{ log }} </span>
    <br>
    {% endfor %}
    
{% endif %}

</body>
</html>